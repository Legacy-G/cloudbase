# To create fresh dump file,
pg_dump -U odoo -d it2025 --format=c --no-owner --no-acl -f it2025_clean.dump


kubectl apply -f persistent-volume.yaml
kubectl apply -f setup-configmap.yaml
kubectl apply -f postgres-deployment.yaml
kubectl apply -f odoo-deployment.yaml
kubectl apply -f service.yaml
kubectl apply -f configmap.yaml

gcloud config set project cloudtrack-dbms

kubectl delete pvc postgres-pvc
kubectl apply -f persistent-volume.yaml
kubectl delete pod -l app=postgres
kubectl delete pod -l app=odoo

kubectl get pods -w
kubectl logs -f postgres-85cbfc7959-dsl7q 

# Inoder to get the IP
kubectl get svc odoo-service

kubectl exec -it postgres-85cbfc7959-dsl7q -- psql -U postgres -c "\du"
kubectl exec -it postgres-85cbfc7959-dsl7q -- psql -U postgres -c "\l"
kubectl exec -it postgres-85cbfc7959-dsl7q -- psql -U postgres -d it2025 -c "SELECT name FROM ir_module_module WHERE state != 'installed';"

kubectl logs odoo-5c4c79995d-wvmbw
kubectl logs odoo-5c4c79995d-fddfd

# Run To get the odoo pods specificly
kubectl get pods -l app=odoo
# The current Odoo Pods
odoo-5c4c79995d-fddfd
odoo-5c4c79995d-wvmbw

# To get the pod bash
kubectl exec -it odoo-5c4c79995d-jmpvt -- bash
# So i can run the following inside it in order To
# Reinitialize core modules, Fix broken routes and menus,
# Stop the container after setup (Kubernetes will restart it)
# Pod-Bash
odoo --db-filter=it2025 --init=base,web,mail --update=all --stop-after-init

# To describe port
kubectl describe pod postgres-f687c7659-zgcrb

# To delete cluster
gcloud container clusters delete odoo-cluster-v2 --zone us-central1-a --project cloudtrack-dbms

# To Create cluster
gcloud container clusters create odoo-cluster-v2 \
  --zone us-central1-a \
  --num-nodes=3 \
  --disk-size=50 \
  --project cloudtrack-dbms

# Then Create setup-script file
kubectl create configmap setup-script --from-file=setup.sh

kubectl apply -f persistent-volume.yaml
kubectl apply -f postgres-deployment.yaml

# Check Pods and View Logs
kubectl get pods -w
kubectl logs -f <new-postgres-pod-name>

# When db role and database it2025 is confirmed created, then procede to
kubectl create configmap odoo-config --from-file=odoo.conf
kubectl apply -f odoo-deployment.yaml
kubectl delete pod -l app=odoo
kubectl apply -f service.yaml
kubectl get svc

kubectl exec -it odoo-5c4c79995d-dc6w8 -- psql -U postgres
